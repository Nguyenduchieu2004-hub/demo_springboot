<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>‚öΩ Qu·∫£n l√Ω C·∫ßu th·ªß (AJAX + Ph√¢n trang)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>

  <body class="bg-light">
    <div class="container py-4">
      <h2 class="text-center text-primary mb-4">‚öΩ Qu·∫£n l√Ω C·∫ßu th·ªß</h2>

      <!-- FORM TH√äM / C·∫¨P NH·∫¨T -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <strong>Th√™m / C·∫≠p nh·∫≠t c·∫ßu th·ªß</strong>
        </div>
        <div class="card-body">
          <form id="cauThuForm">
            <input type="hidden" id="maCauThu" />
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label">H·ªç t√™n</label>
                <input type="text" id="hoTen" class="form-control" required />
              </div>
              <div class="col-md-2">
                <label class="form-label">Ng√†y sinh</label>
                <input
                  type="date"
                  id="ngaySinh"
                  class="form-control"
                  required
                />
              </div>
              <div class="col-md-3">
                <label class="form-label">Kinh nghi·ªám</label>
                <input
                  type="text"
                  id="kinhNghiem"
                  class="form-control"
                  required
                />
              </div>
              <div class="col-md-2">
                <label class="form-label">V·ªã tr√≠</label>
                <input type="text" id="viTri" class="form-control" required />
              </div>
              <div class="col-md-2">
                <label class="form-label">Gi·ªõi t√≠nh</label>
                <select id="gioiTinh" class="form-select" required>
                  <option value="true">Nam</option>
                  <option value="false">N·ªØ</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">T√™n file h√¨nh ·∫£nh</label>
                <input
                  type="text"
                  id="hinhAnh"
                  class="form-control"
                  placeholder="vd: messi.jpg"
                  required
                />
              </div>
              <div class="col-md-12 text-end">
                <button type="submit" class="btn btn-success mt-2">
                  üíæ L∆∞u
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- DANH S√ÅCH C·∫¶U TH·ª¶ -->
      <div class="card shadow-sm">
        <div
          class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
        >
          <span>Danh s√°ch c·∫ßu th·ªß</span>
          <button class="btn btn-sm btn-secondary" id="btnRefresh">
            üîÑ T·∫£i l·∫°i
          </button>
        </div>
        <div class="card-body p-0">
          <table
            class="table table-striped table-bordered text-center align-middle mb-0"
          >
            <thead class="table-dark">
              <tr>
                <th>STT</th>
                <th>M√£ C·∫ßu Th·ªß</th>
                <th>H·ªç T√™n</th>
                <th>Ng√†y Sinh</th>
                <th>Kinh Nghi·ªám</th>
                <th>V·ªã Tr√≠</th>
                <th>H√¨nh ·∫¢nh</th>
                <th>Gi·ªõi T√≠nh</th>
                <th>Thao T√°c</th>
              </tr>
            </thead>
            <tbody id="tbodyCauThu"></tbody>
          </table>
        </div>

        <!-- PH√ÇN TRANG -->
        <div class="card-footer text-center">
          <nav>
            <ul
              class="pagination justify-content-center mb-0"
              id="pagination"
            ></ul>
          </nav>
        </div>
      </div>
    </div>

    <script>
      const BASE_URL = "http://localhost:8080/v1/api/cauthus";
      let currentPage = 0;
      const pageSize = 5;

      // ‚úÖ 1. Hi·ªÉn th·ªã danh s√°ch c·∫ßu th·ªß c√≥ ph√¢n trang
      function loadCauThu(page = 0) {
        $.get(`${BASE_URL}?page=${page}&size=${pageSize}`, function (data) {
          $("#tbodyCauThu").empty();
          const list = data.content || [];
          if (list.length > 0) {
            list.forEach((ct, index) => {
              $("#tbodyCauThu").append(`
            <tr>
              <td>${index + 1 + page * pageSize}</td>
              <td>${ct.maCauThu}</td>
              <td>${ct.hoTen}</td>
              <td>${ct.ngaySinh}</td>
              <td>${ct.kinhNghiem}</td>
              <td>${ct.viTri}</td>
              <td><img src="http://localhost:8080/images/${
                ct.hinhAnh
              }" width="80" height="100" class="img-thumbnail"></td>
              <td>${ct.gioiTinh ? "Nam" : "N·ªØ"}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary" onclick="editCauThu(${
                  ct.maCauThu
                })">‚úèÔ∏è</button>
                <button class="btn btn-sm btn-outline-danger" onclick="deleteCauThu(${
                  ct.maCauThu
                })">üóëÔ∏è</button>
              </td>
            </tr>
          `);
            });
          } else {
            $("#tbodyCauThu").append(
              `<tr><td colspan="9" class="text-danger">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`
            );
          }
          renderPagination(data.totalPages, data.number);
        }).fail(() => alert("‚ùå L·ªói t·∫£i d·ªØ li·ªáu!"));
      }

      // ‚úÖ 2. V·∫Ω ph√¢n trang
      function renderPagination(totalPages, current) {
        $("#pagination").empty();
        if (totalPages > 1) {
          $("#pagination").append(`
        <li class="page-item ${current === 0 ? "disabled" : ""}">
          <a class="page-link" href="#" onclick="loadCauThu(${
            current - 1
          })">Tr∆∞·ªõc</a>
        </li>
      `);
          for (let i = 0; i < totalPages; i++) {
            $("#pagination").append(`
          <li class="page-item ${i === current ? "active" : ""}">
            <a class="page-link" href="#" onclick="loadCauThu(${i})">${
              i + 1
            }</a>
          </li>
        `);
          }
          $("#pagination").append(`
        <li class="page-item ${current === totalPages - 1 ? "disabled" : ""}">
          <a class="page-link" href="#" onclick="loadCauThu(${
            current + 1
          })">Sau</a>
        </li>
      `);
        }
      }

      // ‚úÖ 3. Th√™m / C·∫≠p nh·∫≠t c·∫ßu th·ªß
      $("#cauThuForm").submit(function (event) {
        event.preventDefault();
        const cauThu = {
          maCauThu: $("#maCauThu").val(),
          hoTen: $("#hoTen").val(),
          ngaySinh: $("#ngaySinh").val(),
          kinhNghiem: $("#kinhNghiem").val(),
          viTri: $("#viTri").val(),
          hinhAnh: $("#hinhAnh").val(),
          gioiTinh: $("#gioiTinh").val() === "true",
        };
        const id = $("#maCauThu").val();

        if (id) {
          $.ajax({
            url: BASE_URL + "/" + id,
            type: "PATCH",
            contentType: "application/json",
            data: JSON.stringify(cauThu),
            success: function () {
              alert("‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!");
              $("#cauThuForm")[0].reset();
              $("#maCauThu").val("");
              loadCauThu(currentPage);
            },
            error: () => alert("‚ùå L·ªói c·∫≠p nh·∫≠t!"),
          });
        } else {
          $.ajax({
            url: BASE_URL,
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(cauThu),
            success: function () {
              alert("‚úÖ Th√™m m·ªõi th√†nh c√¥ng!");
              $("#cauThuForm")[0].reset();
              loadCauThu(currentPage);
            },
            error: () => alert("‚ùå L·ªói th√™m m·ªõi!"),
          });
        }
      });

      // ‚úÖ 4. S·ª≠a
      function editCauThu(id) {
        $.get(BASE_URL + "/" + id, function (data) {
          $("#maCauThu").val(data.maCauThu);
          $("#hoTen").val(data.hoTen);
          $("#ngaySinh").val(data.ngaySinh);
          $("#kinhNghiem").val(data.kinhNghiem);
          $("#viTri").val(data.viTri);
          $("#hinhAnh").val(data.hinhAnh);
          $("#gioiTinh").val(data.gioiTinh ? "true" : "false");
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }

      // ‚úÖ 5. X√≥a
      function deleteCauThu(id) {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a c·∫ßu th·ªß n√†y?")) {
          $.ajax({
            url: BASE_URL + "/" + id,
            type: "DELETE",
            success: function () {
              alert("üóëÔ∏è X√≥a th√†nh c√¥ng!");
              loadCauThu(currentPage);
            },
            error: () => alert("‚ùå L·ªói khi x√≥a!"),
          });
        }
      }

      // ‚úÖ 6. L√†m m·ªõi
      $("#btnRefresh").click(() => loadCauThu(currentPage));

      // ‚úÖ G·ªçi khi load trang
      $(document).ready(() => loadCauThu());
    </script>
  </body>
</html>
